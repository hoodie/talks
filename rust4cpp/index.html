<!DOCTYPE html>
<html>

<head>
    <title>Rust for C++ Developers</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <link rel="stylesheet" href="theme/fonts/fonts.css">
    <link rel="stylesheet" href="lib/reveal.css">
    <link rel="stylesheet" href="theme/hoodie-solarized.css">
    <link rel="stylesheet" href="theme/font-awesome/all.min.css">
    <link rel="stylesheet" href="theme/tomorrow.css">
    <link rel="stylesheet" href="theme/talk.css">

    <script src="./gamepad.js">
    </script>
    <script>
        if (navigator.userAgent.match(/Firefox/)) window.toggleGamePadControls();
        else console.warn('no gamepad support')
    </script>
</head>

<body>

    <div class="reveal">
        <div class="slides">

            <section id="title" class="black-slide" data-background-color="var(--background-color-dark)">

                <section id="start">
                    <h4> 07.04.2020</h4>
                    <h2> Rust </h2>
                    <h6> for C++ Developers </h6>
                </section>

            </section>

            <section id="me" data-background-color="#ffffff" data-transition="zoom" data-background-transition="zoom">
                <div class="notes">

                </div>
                <h3>
                    <code>

                    $whoami<span class="blinking">&block;</span>
                    </code>
                </h3>
                <div style="background-image: url(./images/doodles.png); background-repeat: no-repeat">
                    <ul style="list-style-type:none;">
                        <li> <a href="https://www.hoodie.de"> ðŸ¤“ </a> Hendrik Sollich</li>
                        <li> <a href="https://www.gotomeeting.com/"> ðŸ‘” </a> LogMeIn (GoToMeeting <i
                                class="fa fa-microphone-alt"></i>)</li>
                        <li><a href="https://github.com/hoodie/"><i class="fab fa-github"></i></a> hoodie </li>
                        <li><a href="https://twitter.com/hoodie_de"><i class="fab fa-twitter"></i></a> @hoodie_de </li>
                        <li><a href="https://akronymisier.bar"><i class="fa fa-headphones"></i></a> akronymisier.bar
                        </li>
                    </ul>
                </div>

            </section>

            <section data-markdown>
                ### Disclaimer
                * no Rust prior knowledge assumed
                * not a tutorial
                * put it in context
                * learning references at the end
            </section>

            <section data-markdown>
                ## What is Rust?

                <textarea>
                > Rust is a systems programming language that runs blazingly fast, prevents segfaults, and guarantees thread safety
                </textarea>
                or
                <textarea>
                > A language empowering everyone to build reliable and efficient software.
                </textarea>

            </section>

            <!--
            <section>
                <h4>TODO Rust vs C++</h4>
                <ul>
                    <li>Fine grained control</li>
                    <li>memory safety without a gc</li>
                    <li>inheritance free high level abstractions</li>
                    <li>modules, functional programming, "concepts", optionals</li>
                    <li>exception free error handling</li>
                    <li><a href="https://godbolt.org/z/a-vhLU">ranges v3</a> vs <a href="https://godbolt.org/z/vgJpuq">Rust iterators</a></li>
                    <li>very beginner friendly, great documentation</li>
                    <li>much more explicit than C++</li>
                    <li>*<a href="https://msrc-blog.microsoft.com/2019/07/22/why-rust-for-safe-systems-programming/">why rust for safe systems programming</a></li>
                </ul>
            </section>
            -->

            <section id="history">
                <section>
                    <h4>History</h4>

                    <ul>
                        <li> 2006 started by Graydon Hoare </li>
                        <li> 2009 mozilla research project </li>
                        <li class="fragment">"safer language for building browsers" <sup><a
                                    href="https://www.mozilla.org/en-US/security/advisories/mfsa2020-11/">*</a></sup>
                        </li>
                        <li class="fragment"> 2012 servo </li>
                        <li class="fragment"> 2015 ðŸŽ‰ *1.0* ðŸ¥³ </li>
                        <li class="fragment"> 2009 Go</li>
                    </ul>
                </section>

                <section>
                    <aside class="notes">
                        why should you work with rust?
                        should you rewrite things in rust?
                    </aside>
                    <h3>But what does that mean for you?<h3>
                </section>
            </section>

            <section id="quick-facts">
                <section>
                    <h3>What Kind of Language is it?<h3>
                </section>

                <section data-markdown>
                    #### Today it fills the same niche as C++:
                    1. High-level
                    1. Zero Cost abstractions
                    1. no performance compromise
                </section>

                <section data-markdown>
                    1. it's like C++
                    1. it's very much NOT like C++
                </section>

                <section>
                    <h4>Highlighted Differences <cite><a href="https://www.youtube.com/watch?v=7dkL4xv9HbE">Michal Vaner
                                2019</a></cite></h4>
                    <small>
                        <ul>
                            <li class="fragment">Drops 47years of baggage</li>
                            <li class="fragment">Drops Complexity</li>
                            <li class="fragment">ML Parentage</li>
                            <li class="fragment">Attitude towards Developer</li>
                        </ul>
                    </small>
                </section>

                <section>
                    <h4>Attitude towards Developer
                        <cite><a href="https://www.youtube.com/watch?v=7dkL4xv9HbE">Michal Vaner 2019</a></cite></h4>
                    <small>
                        <ul>
                            <li class="fragment">Errare humanum est</li>
                            <li class="fragment">Cognitive bandwidth is limited <span class="fragment">â˜€ðŸ•– or ðŸ•‘ðŸŒ™</span></li>
                            <li class="fragment">Compiler is your friend</li>
                            <li class="fragment">Error Messages are helpers</li>
                            <li class="fragment">You write the safe code</li>
                        </ul>
                    </small>
                </section>

            </section>


            <section id="quick-facts">
                <section data-markdown>
                    ### Main Goals

                    1. Performant
                    1. Safe
                    1. Productive / Ergonomic
                </section>

                <section data-markdown>
                    ### Performant
                    * zero cost abstractions
                    * close to the hardware
                    * no GC
                    * no runtime
                    * system threads
                    * async/await
                    * C FFI (bindgen both directions)
                </section>

                <section data-markdown>
                    ### Safe

                    <textarea>
                    * no unintialized variables
                    * no UB
                    * strong types that guarantee
                        * no race conditions
                        * clear ownership/lifetimes
                        * when to copy/move
                    * immutability
                    * mutexes are containers
                    </textarea>
                </section>

                <section data-markdown>
                    ### Ergonomic
                    * cargo: build test doc bench publish
                    * modules
                    * pattern matching
                    * optionals
                    * friendly compiler
                    * great 3rd party crates
                </section>

            </section>

            <section id="familiar-concepts">

                <section data-markdown id="familiar-concepts-1">
                    #### Familiar concepts 1/2

                    <textarea>
  | C++               | Rust                 |             |
  | ----------------- | -------------------- | ----------- |
  | primitive types   | primitive types      |  `= + â‰  `   |
  | RAII / DRES       | RAII / <abbr title="destructors run on exit scope">DRES</abbr>          |  `=`        |
  | `struct`/` class` | `struct`/`enum`      |  `=`        |
  | `enum`            | `enum`               |  `=`        |
  | methods           | associated function  |  `â‰ `        |
  | `union`           | `enum` (algrebraic)  |  `â‰ `        |
  | `namespace`       | modules              |  `= / â‰ `    |
  | `#include`        | modules              |  `= / â‰ `    |
  | Templates         | generics             |  `â‰ `        |
  | interface `class` | `trait`              |  `â‰ `        |
  | Concepts          | trait bounds         |  `â‰ `        |
  | Attributes        | traits / proc macros |  `â‰ `        |
  | Inheritance       | Composition          |  `â‰ `        |

                    </textarea>
                </section>

                <section data-markdown id="familiar-concepts-1">
                    #### familiar concepts 2/2

                    <textarea>
  | C++               | Rust                 |             |
  | ----------------- | -------------------- | ----------- |
  | `unique_ptr<T>`         | `Box<T>`               |  `=`        |
  | `shared_ptr<T>`         | `Rc<T>`, `Arc<T>`      |  `= + â‰  `   |
  | default copy semantics  | default move semantics |  `â‰  `       |
  | text replacement macros | hygenic AST functions  |  `= + â‰  `   |
  | `auto`, `decl-type`     | hinley-millner types   |  `= + â‰  `   |
  | `std::text_view`        | `&str`                 |  `â‰ `        |
  | `exceptions`            | `panic!()`             |  `â‰ `        |
  | `42i64`                 | `INT64_C`              |             |
  | `42i64`                 | `42i64`                | C++23       |
  | `1_000_000`             | `1'000'000'`           |             |
  |                         |                        |             |

                    </textarea>
                </section>

            </section>

            <section>
                <section>
                    <h4> move semantics & ownership </h4>

                    <pre class="rust execute fragment"><code>fn main() {
    let v = vec![1, 2, 3];
    print_vec(v);
    print_vec(v);
}

fn print_vec(v: Vec&lt;i32&gt;) {
    println!("v is {:?}", v);
}</code></pre>
                </section>
                <section>
                    <pre class="rust execute "><code>
let v = vec![1, 2, 3];
print_vec(&v);
print_vec(&v);

fn print_vec(v: &Vec&lt;i32&gt;) {
    println!("v is {:?}", v);
}</code></pre>
                </section>
            </section>

            <section>
                <section>
                    <h4>structs</h4>

                    <pre class="rust fragment"><code> // named-field struct
struct Person<T> {
    name: String,
    age: u16,
    hobby: T,
}

// tuple struct
struct Coordinate(u32, u32);
struct Some<T>(T);

// union
struct None;
</code></pre>
                </section>

                <section>
                    <h4>enums</h4>

                    <pre class="rust"><code>enum TrafficLight {
    Red,
    Yellow,
    Green,
}
let light = TrafficLight::Green;
match light {
    TrafficLight::Red => println!("STOP!"),
    TrafficLight::Yellow => println!("Slow down!"),
    TrafficLight::Green => println!("Go go go!"),
}</code></pre>
                </section>

                <section>
                    <h4>methods</h4>
                    <pre class="rust execute"><code>struct Person {
    name: String,
}
impl Person {
    pub fn new() -> Person {
        Person {
            name: String::from("Hendrik")
        }
    }
}</code></pre>
                </section>

                <section>
                    <h4>Default Constructor?</h4>
                    <pre class="rust execute"><code>struct Person {
    name: String,
}

impl Default for Person {
    pub fn default() -> Person {
        Person {
            name: String::from("Hendrik")
        }
    }
}
</code></pre>
                </section>

                <section>
                    <h4>Copy Constructor?</h4>

                    <pre class="rust execute"><code>#[derive(Copy, Clone)]
struct Person {
    name: String,
} </code></pre>
                </section>

                <section>
                    <h4>Operator Overloading?</h4>
                    <pre class="rust execute"><code>struct Number(i32);

impl std::ops::Add for Number {
    type Output = Self;

    fn add(self, other: Self) -> Self {
        Self (self.0 + other.0)
    }
}</code></pre>
                </section>

            </section>


            <section>
                <section data-markdown> ### strings </section>
                <section>
                    <h4>string</h4>
                    <pre class="cpp"><code>template<
    class CharT,
    class Traits = std::char_traits&lt;CharT&gt;,
    class Allocator = std::allocator&lt;CharT&gt;
> class basic_string;

std::string    // std::basic_string&lt;char&gt;
std::wstring   // std::basic_string&lt;wchar_t&gt;
std::u8string  // (since C++20) std::basic_string&lt;char8_t&gt;</code></pre>

                    <h4>string_view</h4>
                    <pre class="cpp"><code>template<
    class CharT,
    class Traits = std::char_traits&lt;CharT&gt;
> class basic_string_view;</code></pre>
                </section>

                <section>
                    <h4>String, &str etc</h4>
                    <pre class="rust"><code>// owned strings
let hello_owned: String = String::from("hello world");

/// string slices
let hello_slice = "hello world" // &'static str;
let hello_slice = &hello_owned // &str;</code></pre>

                    <pre class="rust"><code>// CStrings (C-compatible, nul-terminated string)
std::ffi::CString;
std::ffi::CStr;

// OsString https://doc.rust-lang.org/stable/std/ffi/struct.OsString.html
std::ffi::OsString;
std::ffi::OsStr; </code></pre>
                </section>
            </section>

            <section>
                <section>
                    <h3>Modules</h3>
                    <ul>
                        <li class="fragment">componentization</li>
                        <li class="fragment">explicit exports</li>
                        <li class="fragment">compilation unit</li>
                        <li class="fragment">file layout</li>
                        <li class="fragment">namespacing</li>
                    </ul>
                </section>

                <section>
                    <h4>C++ modules</h4>
                    <span class="fragment">
                        <pre class="cpp"><code>// ModuleA.ixx
export module ModuleA;

namespace Bar
{
   export int f();
   export double d();
   double internal_f(); // not exported
}</code></pre>
                        <pre class="cpp"><code>//MyProgram.cpp
import module ModuleA;

int main() {
  Bar::f(); // OK
  Bar::d(); // OK
  Bar::internal_f(); // Ill-formed: error C2065: 'internal_f': undeclared identifier
}
</code></pre>
                        <a href="https://docs.microsoft.com/en-us/cpp/cpp/import-export-module?view=vs-2019">*</a>
                    </span>
                </section>

                <section>
                    <h4>Rust Modules Â½</h4>
                    <pre class="rust execute"><code>// main.rs
mod bar {
   pub fn f() -> i32 { internal_f() }
   pub fn d() -> f64 { 13.37 }

   // not exported
   fn internal_f() -> i32 { 13 }
}

fn main() {
  bar::f(); // OK
  bar::d(); // OK
  // bar::internal_f(); wouldn't compile
}
</code></pre>
                </section>

                <section>
                    <h4>Rust Modules</h4>
                    <pre class="rust"><code>// bar.rs
pub fn f() -> i32 { internal_f() }
pub fn d() -> f64 { 13.37 }

// not exported
fn internal_f() -> i32 { 13 }</code></pre>
                    <pre class="rust"><code>// main.rs
mod bar;

fn main() {
  bar::f(); // OK
  bar::d(); // OK
  // bar::internal_f(); wouldn't compile
}</code></pre>
                </section>

            </section>

            <section id="iterators">
                <section>
                    <h4>Iterators</h4>
                    <ul>
                        <li>all via <code>Iterator</code> Trait <sup><a
                                    href="https://doc.rust-lang.org/std/iter/trait.Iterator.html">*</a></sup></li>
                        <li>Lazy</li>
                    </ul>
                    <pre class="rust execute"><code>(0..100_000)
    .map(|x: u32| x * 3) 
    .filter(|x| x.count_zeros() > 5)
    .map(|x| format!("{:b}", x))
    .take(3)
    .collect::&lt;Vec&lt;String&gt;&gt;();</code></pre>
                </section>

                <section>
                    <img data-src="./img/ranges-cpp.jpg" style="width: 80%" />
                    <blockquote>
                        Hold my beer.
                        <cite>
                            <a href="https://twitter.com/ericniebler/status/1167172402184216576">@ericniebler</a>
                        </cite>
                    </blockquote>
                </section>

                <section>
                    <img data-src="./img/ranges-rust.jpg" style="width: 100%" />
                    <blockquote>
                        not too shabby in rust either
                        <cite>
                            <a href="https://twitter.com/steveklabnik/status/1167204430401495040">@steveklabnik</a>
                        </cite>
                    </blockquote>
                </section>

            </section>

            <section>

                <section>
                    <h3>synchronization</h3>
                </section>

                <section>
                    <h4>Mutexes</h4>
                    <pre class="rust execute"><code>use std::sync::{Arc, Mutex};
use std::thread;

let mutex = Arc::new(Mutex::new(0));

{
    let mutex = mutex.clone();
    
    thread::spawn(move || {
        let mut target = mutex.lock().unwrap();
        *target = 10;
    }).join().unwrap()
}</code></pre>
                </section>

                <section>
                    <h4>Channels</h4>
                    <pre class="rust execute"><code>use std::sync::mpsc::channel;
use std::thread;

let (sender, receiver) = channel();

// Spawn off an expensive computation
thread::spawn(move|| {
    sender.send(expensive_computation()).unwrap();
});
</code></pre>
                </section>

                <section>
                    <h3>Async Rust</h3>
                    <ul>
                        <li> <a href="https://async.rs/">async-std</a> </li>
                        <li> <a href="https://tokio.rs/">tokio</a> </li>
                    </ul>
                </section>

            </section>

            <!--vs protobuf-->
            <section id="serde">
                <section>
                    <h2>serde</h2>
                    <ul>
                        <li>generic (de)serialization framework</li>
                    </ul>
                </section>

                <section>
                    <h4> Command Type (rust) </h4>
                    <pre class="rust execute"><code>#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase", tag = "kind")]
pub enum SessionCommand {
    Join { room: String },
    Message { message: String, room: usize },
    ListRooms,
}

let message = SessionCommand::Message{
    message: String::from("hello there"),
    room: 5,
};

println!("{}", serde_json::to_string(&message).unwrap())
</code></pre>
                    <pre><code class="json">
{ "type": "join", "room": 5, "message": "hello there"},
                   </code></pre>

                </section>

            </section>

            <section>
                <section id="what-to-use-it-for" data-markdown>
                    ## what to use it for?

                    * components
                    * everywhere you would have reached for C/C++ as a last resort
                    * where you need more typesafety
                    * don't RIIR - but if you start fresh any?
                    * parsers, network services
                    * WebAssembly
                    * where you would have reached for python

                </section>
            </section>

            <section id="how-to-start" data-markdown>
                * rust by example
                * book
                * std.rs
                * rust dresden
                * play.rustlang.org
                * https://github.com/rust-lang/rustlings
            </section>

        </div>
    </div>

    <script src="lib/reveal.js"></script>
    <script src="lib/head.js"></script>
    <script src="lib/highlight.pack.js"></script>
    <script src="add_playpen.js"></script>
    <script>

        hljs.initHighlightingOnLoad();
        Reveal.initialize({
            controlsTutorial: true,
            history: true,
            slideNumber: true,
            progress: true,
            transition: 'convex', // none/fade/slide/convex/concave/zoom
            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [
                { src: './plugin/markdown/marked.js' },
                { src: './plugin/markdown/markdown.js' },
                { src: './plugin/notes/notes.js', async: true },
                /*
                { src: './plugin/menu/menu.js' }
                { src: 'socket.io/socket.io.js', async: true },
                { src: 'plugin/notes-server/client.js', async: true }
                 */
            ]
        });

        window.onGamePadUpPressed = () => Reveal.up();
        window.onGamePadDownPressed = () => Reveal.down();
        window.onGamePadLeftPressed = () => Reveal.left();
        window.onGamePadRightPressed = () => Reveal.right();
        window.onGamePadL1Pressed = () => Reveal.slide(0);
        window.onGamePadR1Pressed = () => Reveal.togglePause();
        window.onGamePadL2Pressed = () => Reveal.prev();
        window.onGamePadR2Pressed = () => Reveal.next();
        window.onGamePadOPressed = () => Reveal.togglePause();
        window.onGamePadXPressed = () => Reveal.next();
        window.onGamePadSqPressed = () => Reveal.prev();

    </script>

</body>

</html>